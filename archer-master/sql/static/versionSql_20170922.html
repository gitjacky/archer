{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
	<div class="panel panel-default" style="width: 1070px;height: 100%;padding-bottom: 15px">
        <div class="panel panel-heading"><h4>版本SQL发布</h4></div>

	<form id="form-versionsql" action="/versions/" method="post" class="form-inline" role="form" style="padding-left: 30px">

		{% csrf_token %}

		<div class="row">
				<div class="form-group">
                    <label class="sr-only control-label" for="workflow_name">上线单名称</label>
					<input id="workflow_name" type="text" name="workflow_name" class="form-control" style="width: auto;" data-name="上线单名称" placeholder="请输入上线单名称，如:XX项目版本发布" required>
				</div>
				<div class="form-group" style="width: 125px">
                    <label class="sr-only control-label" for="cluster_name">选择SVN目录</label>
					<select id="svn_path" name="svn_path" style="font-size:12px;color:blue" class="selectpicker show-tick form-control bs-select-hidden" onchange="getSelect()" data-name="选择SVN目录" data-placeholder="选择SVN目录:" required>
          				<option  value="is-empty" disabled="" selected="selected">选择SVN目录</option>
                        <option  value="02Release">02Release</option>
                        <option  value="03UAT_Tags">03UAT_Tag</option>
						        		
					</select>
				</div>

				<div class="form-group" style="width: 120px">
                    <label class="sr-only control-label" for="project_name_1">父项目名</label>
					<select id="p_name" name="p_name" class="selectpicker show-tick form-control bs-select-hidden" data-name="父项目名" data-placeholder="父项目名" required>
          				<option value="is-empty" disabled="" selected="selected">父项目名</option>
        			</select>	
				</div>

				<div class="form-group" style="width: 120px">
                    <label class="sr-only control-label" for="project_name_2">子项目名</label>
					<select id="s_name" name="s_name" class="selectpicker show-tick form-control bs-select-hidden" data-name="子项目名" data-placeholder="子项目名" required>
          				<option value="is-empty" disabled="" selected="selected">子项目名</option>
        			</select>
				</div>

				<div class="form-group" style="width: 130px">
                    <label class="sr-only control-label" for="review_man">选择版本号</label>
					<select id="sub_version" name="sub_version" class="selectpicker show-tick form-control bs-select-hidden" data-name="版本号" data-placeholder="选择版本号:" required>
          			<option value="is-empty" disabled="" selected="selected">选择版本号</option>
					</select>
				</div>

				<div class="form-group" style="width: 110px">
                    <label class="sr-only control-label" for="review_man">发布环境</label>
					<select id="d_envirment" name="d_envirment" class="selectpicker show-tick form-control bs-select-hidden" data-name="发布环境" data-placeholder="发布环境:" required>
          			<option value="is-empty" disabled="" selected="selected">发布环境</option>
                    {% for cluster_name,dbs in dictAllClusterDb.items %}
                        <option value="{{cluster_name}}">{{cluster_name}}</option>
                    {% endfor %}
					</select>
				</div>

				<div class="form-group" style="width: 110px">
                    <label class="sr-only control-label" for="review_man">选择审核人</label>
					<select id="review_man" name="review_man" class="selectpicker show-tick form-control bs-select-hidden" data-name="审核人" data-placeholder="选择审核人:" required>
          			<option value="is-empty" disabled="" selected="selected">选择审核人</option>
					{% for man in reviewMen %}
					<option value="{{man}}">{{man}}</option>
					{% endfor %}
					</select>
				</div>
            <table class="table table-striped table-hover" style="width: 1025px;">
                <thead>
                <tr>
                    <th style="width: 50px">ID</th>
                    <th>脚本文件名称</th>
                    <th style="width: 50px">选择</th>
                </tr>
                </thead>

                <tbody>
                    <tr>
                        <td>1</td>
                        <td>Fss_create_table_01.sql</td>
                        <td><label><input type="checkbox"/></label></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Fss_create_table_02.sql</td>
                        <td><label><input type="checkbox"/></label></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Fss_create_table_03.sql</td>
                        <td><label><input type="checkbox"/></label></td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>Fss_create_table_04.sql</td>
                        <td><label><input type="checkbox"/></label></td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>Fss_create_table_05.sql</td>
                        <td><label><input type="checkbox"/></label></td>
                    </tr>

                </tbody>

            </table>
				<div class="form-group">
                    <button type="button" class="btn btn-danger" style="margin-left: 0px; width: 80px; height: 35px;" onclick="selectAll()">全选</button>
                    <button type="reset" class="btn btn-warning" style="margin-left: 10px;" >清空选项</button>
                    <button type="button" class="btn btn-info" style="margin-left: 10px; width: 80px;height: 35px;" onclick="unSelect()">取消全选</button>
                    <input type="button" id="btn-versionsql" class="btn btn-primary" style="margin-left: 10px;"  value="提交工单" />
				</div>
        </div>
	</form>
    </div>
</div>

	<div id="inception-result" style="display:none;" class="row clearfix">
		<br/>
		<div id="inception-result-col" class="col-md-12">
		
		</div>
	</div>
<script type="text/javascript">
    function selectAll(){
        $("INPUT[type='checkbox']").each( function() {
            $(this).prop('checked', true);
            $(this).addClass('checked');
        });
    };

    function unSelect(){
        $("INPUT[type='checkbox']").each( function() {
            $(this).prop('checked', false);
            $(this).removeClass('checked');

      });
    };

    function getSelect(){
        var base_svn = document.getElementById("svn_path");
        console.log(base_svn.value);
        $.ajax({
            type:"GET",
            url:"/versioninfo/",
            async: "false",
            dataType: "json",
            data:{base_svn:base_svn.value},
            //success用来接收versionsql()函数执行之后的return HttpResponse返回值
            success:function(arg){
                console.log(arg.pro_dir);
                var pro_dir=arg.pro_dir;
                var opSelect = document.getElementById("p_name");

                if(pro_dir.length > 0) {
                    var len=pro_dir.length

                    $("#p_name").next('.btn-group').find('ul').html('');
                    for(var i=0;i<len;i++){
                        opSelect.options[i] = new Option();
                        opSelect.options[i].text = pro_dir[i];
                        opSelect.options[i].value = pro_dir[i];

                        var html='<li data-original-index="'+i+'">' +
                            '<a tabindex="'+i+'" data-tokens="null">' +
                            '<span class="text">'+pro_dir[i]+'</span>' +
                            '</span></a></li>';
                         $("#p_name").next('.btn-group').find('ul').append(html);

                    }
                    console.log(opSelect);
                }else
                    $("#p_name").next('.btn-group').find('ul').html('').hide();

                },
            error:function () {
                console.log('failed!')
            }

            });

    };


</script>

{% endblock content %}
